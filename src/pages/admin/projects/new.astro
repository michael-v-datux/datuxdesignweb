---
import { supabase } from '@/lib/supabaseClient.js';

export const prerender = false;

let error = '';
let success = '';

async function handleSubmit(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    const data = {
        slug: formData.get('slug'),
        title_en: formData.get('title_en'),
        title_uk: formData.get('title_uk'),
        description_en: formData.get('description_en'),
        description_uk: formData.get('description_uk'),
        thumbnail: formData.get('thumbnail'),
        is_protected: formData.get('is_protected') === 'on',
        password: formData.get('password'),
        status: formData.get('status')
    };

    const { error: insertError } = await supabase.from('projects').insert([data]);
    if (insertError) {
        error = insertError.message;
    } else {
        success = 'Project created!';
        window.location.href = '/admin/dashboard';
    }
}
---

<html>
  <body class="p-8">
    <h1 class="text-2xl mb-4">Create New Project</h1>
    {error && <p class="text-red-500">{error}</p>}
    {success && <p class="text-green-500">{success}</p>}
    <form on:submit="handleSubmit" class="flex flex-col gap-4 max-w-lg">
      <input type="text" name="slug" placeholder="Slug" required class="p-2 border rounded" />
      <input type="text" name="title_en" placeholder="Title EN" required class="p-2 border rounded" />
      <input type="text" name="title_uk" placeholder="Title UK" required class="p-2 border rounded" />
      <textarea name="description_en" placeholder="Description EN (Markdown)" class="p-2 border rounded"></textarea>
      <textarea name="description_uk" placeholder="Description UK (Markdown)" class="p-2 border rounded"></textarea>
      <input type="url" name="thumbnail" placeholder="Thumbnail URL" class="p-2 border rounded" />
      <div class="flex items-center gap-2">
        <input type="checkbox" name="is_protected" id="is_protected" />
        <label for="is_protected">Password Protected?</label>
      </div>
      <input type="text" name="password" placeholder="Password (if protected)" class="p-2 border rounded" />
      <select name="status" class="p-2 border rounded">
        <option value="draft">Draft</option>
        <option value="published">Published</option>
      </select>
      <button type="submit" class="bg-green-500 text-white p-2 rounded">Create</button>
    </form>
  </body>
</html>