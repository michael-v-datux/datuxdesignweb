---
export const prerender = false;

import Layout from '@/layouts/Layout.astro';
import { getTranslations } from '@/utils/getTranslations';

const { lang, slug } = Astro.params;
const translations = await getTranslations(lang);
---

<Layout translations={translations}>
  <head>
    <title>{translations.protectedProjects.defaultTitle}</title>
  </head>

  <section
    id="project-page"
    class="container mx-auto py-12 px-6 max-w-screen-xl"
    data-slug={slug}
    data-lang={lang}
  >
    <!-- –õ–æ–∞–¥–µ—Ä -->
    <div id="project-loader" class="text-center py-20">
      <p class="text-gray-500">{translations.loading}</p>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–æ–µ–∫—Ç—É -->
    <div id="project-content" class="hidden"></div>

    <!-- –§–æ—Ä–º–∞ –¥–ª—è –∑–∞—Ö–∏—â–µ–Ω–∏—Ö –ø—Ä–æ–µ–∫—Ç—ñ–≤ -->
    <div id="project-password-container" class="hidden">
      <form id="password-form" class="project-pass-form flex flex-col items-center gap-4 transition-all duration-500">
          <h1 class="text-2xl font-semibold mb-4">{translations.protectedProjects.title}</h1>
          <p class="mb-10">{translations.protectedProjects.subtitle}</p>

          <div class="relative w-full max-w-xs">
              <input
                  type="password"
                  id="project-password"
                  placeholder={translations.protectedProjects.passwordPlaceholder}
                  class="border border-neutral-300 rounded px-4 py-2 w-full pr-10"
              />
              <button
                  type="button"
                  id="toggle-password"
                  class="absolute inset-y-0 right-0 px-3 flex items-center text-neutral-500 hover:text-neutral-700"
                  tabindex="-1"
              >
                  üëÅ
              </button>
          </div>

          <div id="terms-block" class="bg-neutral-100 p-4 rounded-xl text-left w-full max-w-xs transition-all">
              <p class="text-xs text-neutral-500 mb-3">{translations.protectedProjects.termsText}</p>
              <div class="flex flex-col items-start gap-1">
                  <div class="flex items-center gap-2">
                      <input type="checkbox" id="accept-terms" class="h-4 w-4">
                      <label for="accept-terms" class="text-sm text-neutral-700">{translations.protectedProjects.checkboxLabel}</label>
                  </div>
                  <p id="terms-error" class="text-red-500 text-sm hidden">{translations.protectedProjects.checkboxError}</p>
              </div>
          </div>

          <div class="flex gap-3">
              <button type="submit" id="unlock-btn" class="btn-primary" disabled>{translations.protectedProjects.unlockButton}</button>
              <button type="button" id="back-btn" class="btn-secondary">{translations.protectedProjects.backButton}</button>
          </div>
          <p id="error-message" class="text-red-500 text-sm hidden">{translations.protectedProjects.wrongPassword}</p>
      </form>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ "—É—Å–ø—ñ—Ö" -->
    <div id="unlock-success-modal" class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-2xl shadow-xl text-center animate-pop">
            <svg class="mx-auto mb-3 w-12 h-12 text-green-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
            </svg>
            <p class="text-lg font-medium">{translations.protectedProjects.accessGranted}</p>
        </div>
    </div>
  </section>

  <script type="module" src="/scripts/features/fetch-project.js"></script>
  <script type="module" src="/scripts/features/project-protected.js"></script>
</Layout>