---
export const prerender = false;

import { supabase } from '@/lib/supabaseClient';

const { translations, lang, loadMore = true } = Astro.props;

// Отримуємо перші 3 проекти
const { data: projectsRaw, error } = await supabase
  .from("projects")
  .select("slug, title_en, title_uk, category_en, category_uk, is_published")
  .eq("is_published", true)
  .order("created_at", { ascending: false })
  .range(0, 2);

if (error) {
  console.error("Error fetching projects:", error);
}

const projects = projectsRaw?.map(p => ({
  slug: p.slug,
  title: lang === "en" ? p.title_en : p.title_uk,
  category: lang === "en" ? p.category_en : p.category_uk
})) || [];
---

<section id="selected-projects" class="selected-projects w-full py-12 px-6 md:px-10 lg:px-16">
  <div class="max-w-6xl mx-auto text-center">
    <h2 class="text-2xl md:text-3xl font-semibold mb-12">
      {translations.selectedProjects.title}
    </h2>

    {projects && projects.length > 0 ? (
      <div id="projects-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 justify-center">
        {projects.map((item) => (
          <a href={`/${lang}/projects/${item.slug}`}
             class="project-card group block w-full h-[300px] border border-neutral-200 rounded-xl px-6 text-center relative overflow-hidden transition-colors hover:bg-neutral-100 mx-auto flex flex-col items-center justify-center opacity-0 translate-y-4">
              <!-- Категорія: тільки на hover -->
              <span class="block text-neutral-800 opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-sm mb-1">
                {item.category}
              </span>
              <!-- Заголовок: завжди видно -->
              <span class="text-lg font-medium text-neutral-800">{item.title}</span>
          </a>
        ))}
      </div>
    ) : (
      <p class="text-neutral-500">{lang === 'uk' ? 'Проекти наразі недоступні.' : 'No projects available.'}</p>
    )}

    {loadMore && (
      <button id="load-more" class="mt-8 px-6 py-2 border rounded-lg bg-neutral-100 hover:bg-neutral-200 transition">
        {translations.selectedProjects.loadMore || 'Load more'}
      </button>
    )}
  </div>
</section>

{loadMore && <script type="module" src="/scripts/features/load-more-projects.js"></script>}