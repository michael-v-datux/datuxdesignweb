---
export const prerender = false;

import { supabase } from '@/lib/supabaseClient';

const { translations, lang, loadMore = true } = Astro.props;

// Отримуємо опубліковані проекти
const { data: projects, error } = await supabase
  .from("projects")
  .select("slug, title_en, title_uk, category_en, category_uk, is_published")
  .eq("is_published", true)
  .order("created_at", { ascending: false });

if (error) {
  console.error("Error fetching projects:", error);
}
---

<section id="selected-projects" class="selected-projects w-full py-12 px-6 md:px-10 lg:px-16">
  <div class="max-w-6xl mx-auto text-center">
    <h2 class="text-2xl md:text-3xl font-semibold mb-12">
      {translations.selectedProjects.title}
    </h2>

    {projects && projects.length > 0 ? (
      <div id="projects-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 justify-center">
        {projects.map((item) => (
          <a href={`/${lang}/projects/${item.slug}`}
             class="group block w-full h-[300px] border border-neutral-200 rounded-xl px-6 text-center relative overflow-hidden transition-colors hover:bg-neutral-100 mx-auto flex items-center justify-center">
            <div class="relative flex flex-col items-center justify-center transition-all duration-300">
              <div class="text-lg font-medium text-neutral-800 mb-0 group-hover:mb-2 transition-all duration-300">
                <span class="block text-neutral-800 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                  {lang === 'en' ? item.category_en : item.category_uk}
                </span>
                {lang === 'en' ? item.title_en : item.title_uk}
              </div>
            </div>
          </a>
        ))}
      </div>
    ) : (
      <p class="text-neutral-500">{lang === 'uk' ? 'Проекти наразі недоступні.' : 'No projects available.'}</p>
    )}

    {loadMore && (
      <button id="load-more" class="mt-8 px-6 py-2 border rounded-lg bg-neutral-100 hover:bg-neutral-200 transition">
        {translations.selectedProjects.loadMore || 'Load more'}
      </button>
    )}
  </div>
</section>

{loadMore && <script type="module" src="/scripts/features/load-more-projects.js"></script>}